<!DOCTYPE html>
<html>
	<head>
	<style>
      html, body {
        margin: 0px;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: monospace;
      }
      canvas {
        width: 100%;
        height: 100%;
	}
    </style>
	</head>
	<body>
		<canvas id="c"></canvas>


		<script id="vs-default" type="notjs">
			attribute vec3 a_position;
			attribute vec3 a_normal;

			uniform mat4 u_projection;
			uniform mat4 u_view;
			uniform mat4 model;

			varying vec3 v_normal;
			varying vec3 v_position;

			void main() {
				gl_Position = u_projection * u_view * model * vec4(a_position, 1.0);


				vec3 off = vec3(1.0, 1.0, 0.0);
				float hL = distance(a_position.xy, -off.xz);
				float hR = distance(a_position.xy, +off.xz);
				float hD = distance(a_position.xy, -off.zy);
				float hU = distance(a_position.xy, +off.zy);

				// deduce terrain normal
				v_normal.x = hL - hR;
				v_normal.y = hD - hU;
				v_normal.z = 2.0;


				//v_normal = normalize(mat3(model) * a_normal);
				v_position = a_position;
			}
		</script>
		<script id="fs-default" type="notjs">
			precision mediump float;

			varying vec3 v_normal;
			varying vec3 v_position;
			void main() {
			//	vec3 testDir = normalize(vec3(1000,1000,1000) - gl_FragCoord.xyz);
				float diff = dot(normalize(vec3(1.5,10,1.5)), normalize(v_normal));

		//		gl_FragColor = vec4(vec3(diff) * vec3(0.9, 0.1, 0.1), 1.0);
				gl_FragColor = vec4(normalize(v_normal), 1.0);
			}
		</script>
		<script src="twgl-full.js"></script>
		<script src="bundle.js"></script>
	</body>
</html>
